<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>MidiPlayerJS - JavaScript Midi Player</title>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Bree+Serif" rel="stylesheet">
		<style type="text/css">
			h1,h2,h3,h4 {font-family: 'Bree Serif', serif;}
			#select-file {display:none;}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>MidiPlayerJS</h1>
			<p>This MIDI player is using <a href="https://github.com/grimmdude/MidiPlayerJS">MidiPlayerJS</a> to read the file, and <a href="https://github.com/danigb/soundfont-player">soundfont-player</a> to load and play the sounds.</p>
			<h4>Choose a Midi File</h4>
			<p id="select-file">
				<input type="file" onchange="loadFile()" class="form-control" />
			</p>
			<p id="loading">
				Loading soundfont...
			</p>
			<p>
				<button class="btn btn-primary" onclick="Player.play()">Play</button>
				<button class="btn btn-default" onclick="Player.stop()">Stop</button>
			</p>
			<p>
				<h4>Tempo</h4>
				<input id="test" type="range" min="50" max="200" value="100" onchange="changeTempo(this.value)" style="width:200px;" />
			</p>
			<div id="events"></div>
		</div>
		<a href="https://github.com/grimmdude/MidiPlayerJS"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
		<script src="browser/index.min.js"></script>
		<script src="demo/scripts/soundfont-player.min.js"></script>
		<script>
			var MidiPlayer = require('MidiPlayer');
			var loadFile, changeTempo, Player;
			var ac = new AudioContext;
			Soundfont.instrument(ac, 'https://raw.githubusercontent.com/gleitz/midi-js-soundfonts/gh-pages/MusyngKite/clavichord-mp3.js').then(function (clavinet) {
				document.getElementById('loading').style.display = 'none';
				document.getElementById('select-file').style.display = 'block';

				loadFile = function() {
					var file    = document.querySelector('input[type=file]').files[0];
					var reader  = new FileReader();
					if (file) reader.readAsArrayBuffer(file);

					var eventsDiv = document.getElementById('events');
					eventsDiv.innerHTML = '';

					reader.addEventListener("load", function () {
						Player = new MidiPlayer.Player(function(event) {
							if (event.name == 'Note on') {
								clavinet.play(event.noteName, ac.currentTime, {gain:2});
								document.querySelector('#track-' + event.track + ' code').innerHTML = JSON.stringify(event);
							}	
						});

						Player.loadArrayBuffer(reader.result);

						Player.tracks.forEach(function(item, index) {
							var trackDiv = document.createElement('div');
							trackDiv.id = 'track-' + (index+1);
							var h5 = document.createElement('h5');
							h5.innerHTML = 'Track ' + (index+1);
							var code = document.createElement('code');
							trackDiv.appendChild(h5);
							trackDiv.appendChild(code);
							eventsDiv.appendChild(trackDiv);
						});
					}, false);
				}

				changeTempo = function(tempo) {
					Player.tempo = tempo;
				}
			});
		</script>
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-1454657-6', 'auto');
			ga('send', 'pageview');
		</script>
	</body>
</html>